<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="{{application}}">
  <meta name="generator" content="{{application}} {{version}}">
  <title>Report - {{application}}</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
ata:
    #wrapper {
      overflow-x: hidden;
    }

    #sidebar-wrapper {
      min-height: 100vh;
      margin-left: 0rem;
      -webkit-transition: margin .25s ease-out;
      -moz-transition: margin .25s ease-out;
      -o-transition: margin .25s ease-out;
      transition: margin .25s ease-out;
    }

    #sidebar-wrapper .sidebar-heading {
      padding: 0.875rem 1.25rem;
      font-size: 1.2rem;
    }

    #sidebar-wrapper .list-group {
      width: 13rem;
    }

    #page-content-wrapper {
      min-width: 100vw;
    }

    #wrapper.toggled #sidebar-wrapper {
      margin-left: 0;
    }

    @media (min-width: 768px) {
      #sidebar-wrapper {
        margin-left: 0;
      }

      #page-content-wrapper {
        min-width: 0;
        width: 100%;
      }

      #wrapper.toggled #sidebar-wrapper {
        margin-left: -15rem;
      }
    }
  </style>
  <script>
    data = [];
    {{#scores}}
    data['score{{-index}}']={{data}};
    {{/scores}}

    samples = {{samplesData}};
    selectedData = [];
</script>

</head>


<body>
  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="sidebar-heading">{{application}} {{version}}</div>
      <div class="input-group">
        <input class="field form-control mx-2 mb-3" id="s" name="s" type="text" value="" placeholder="Search by ID or trait" autocomplete="off">
      </div>
      <div class="list-group mx-2" style="overflow-y: scroll; position: fixed; top: 100px; bottom:0px; left: 0px;" role="tablist">
        {{#scores}}
          <a data-toggle="list" href="#score{{-index}}" data-score="score{{-index}}" role="tab" data-meta="{{name}}, {{#meta}}{{trait_reported}}{{/meta}}"
            class="list-group-item list-group-item-action {{#-first}}active{{/-first}}">{{name}}{{#meta}}<br><small>{{trait_reported}}</small>{{/meta}}</a>
        {{/scores}}
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
      <div class="container-fluid">
        <div class="tab-content">
          {{#scores}}
            <div class="tab-pane {{#-first}}active{{/-first}}" id="score{{-index}}" role="tabpanel">
              <h3 class="mt-4">{{name}}</h3>
              <hr>
              <h5>Reference score</h5>
              <ul class="text-small">
                <li>Variants: {{#format}}{{variants}}{{/format}}</li>
                {{#meta}}
                <li>Trait: {{trait_reported}}</li>
                {{#trait_additional}}
                  <li>Additional Trait: {{.}}</li>
                {{/trait_additional}}
                <li>Publication: <a href="https://doi.org/{{publication.doi}}" target="_blank">{{publication.firstauthor}} et.al, {{publication.journal}} ({{publication.date_publication}})</a></li>
                {{/meta}}
                <li>View in <a href="https://www.pgscatalog.org/score/{{name}}" target="_blank">PGS-Catalog</a></li>
              </ul>
              <!--<small class="text-muted pull-right">All meta obtained from <a href="https://www.pgscatalog.org">PGS-Catalog</a></small>-->
              <h5>Target study</h5>
              <ul>
                <li>Coverage: {{#format}}{{variantsUsed}}{{/format}} ({{variantsUsedPercentage}})</li>
                <li>Samples: {{#format}}{{samples.size}}{{/format}}</li>
              </ul>
            </div>
          {{/scores}}
        </div>
        <div class="row">
          <div class="col-sm-6">
            <div class="card">
              <div class="card-header">
                Distribution
              </div>
              <div class="card-body mx-0 my-0">
                <div id="plot" style="height:300px">
                </div>
              </div>
            </div>
          </div>

          <div class="col-sm-6">
            <div class="card">
              <div class="card-header" id="selection-header">
                Selection (0)
              </div>
              <div class="card-body">
                <div style="height:300px; overflow-y: scroll;">
                  <table class="table table-sm table-striped" id="selection-table">
                </div>
                <thead>
                  <tr>
                    <th scope="col">Sample</th>
                    <th scope="col">Score</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
                </table>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

  </main><!-- /.container -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script>
    $('#s').on('input', function(e) {
      let input = $(this).val()
      let filter = input.toUpperCase()
      $('.list-group .list-group-item').each(function() {
        let anchor = $(this)
        if (anchor.data('meta').toUpperCase().indexOf(filter) > -1) {
          anchor.removeClass('d-none')
        } else {
          anchor.addClass('d-none');
        }
      });
    });

    $('.list-group-item').on('click', function(e) {
      var score = $(this).data('score');
      selectedData = data[score];
      var plotData = [{
        x: selectedData,
        type: 'histogram',
        name: 'Distribution',
        orientation: 'v',
        marker: {
          color: 'blue',
          line: {
            color: 'white',
            width: 1
          }
        }
      }];

      var table = $('#selection-table tbody');
      table.html('');
      $('#selection-header').html('Selection (' + 0 + ')');

      Plotly.react('plot', plotData, {
        dragmode: 'select',
        hovermode: 'x',
        margin: {
          l: 50,
          r: 50,
          b: 50,
          t: 0,
          pad: 4
        },
        xaxis: {
          title: 'Score'
        },
        yaxis: {
          title: 'Count'
        },
        bargap: 0
      },{ displayModeBar: false});
    });


    $(document).ready(function() {
      selectedData = data['score1'];
      var plotData = [{
        x: selectedData,
        type: 'histogram',
        name: 'Distribution',
        orientation: 'v',
        marker: {
          color: 'blue',
          line: {
            color: 'white',
            width: 1
          }
        }
      }];
      Plotly.newPlot('plot', plotData, {
        dragmode: 'select',
        hovermode: 'x',
        margin: {
          l: 50,
          r: 50,
          b: 50,
          t: 0,
          pad: 4
        },
        xaxis: {
          title: 'Score'
        },
        yaxis: {
          title: 'Count'
        },
        bargap: 0
      },{ displayModeBar: false});


      var myPlot = document.getElementById('plot');
      var hoverInfo = myPlot.on('plotly_selected', function(eventData) {
        var selection = 0;
        var table = $('#selection-table tbody');
        var rows = '';
        eventData.points.forEach(function(pt) {
          selection += pt.pointIndices.length;
          for (var i = 0; i < pt.pointIndices.length; i++) {
            var index = pt.pointIndices[i];
            rows += '<tr><td>' + samples[index] + '</td><td>' + selectedData[index] + '</td></tr>';
          }
        });
        table.html(rows);
        $('#selection-header').html('Selection (' + selection + ')');

      });

    });
  </script>

</html>
